{% extends "base.html" %}

{% block title %}Hotel Reservas - Lujo en el Coraz√≥n de Santa Victoria{% endblock %}

{% block content %}
    <!-- Hero -->
    <section id="inicio" class="hero">
      <div class="hero-overlay"></div>
      <div class="container hero-content">
        <h1>Bienvenido a Hotel Reservas</h1>
        <p>Experiencia de lujo en el coraz√≥n de Santa Victora. Donde cada detalle cuenta.</p>
        <div class="hero-actions">
          <button class="btn btn-primary btn-lg" id="btnReservarAhora">
            Reservar Ahora
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </button>
          <button class="btn btn-white btn-lg">Ver habitaciones</button>
        </div>
      </div>
    </section>

    <!-- Tabs de Servicios -->
    <section id="tabs" class="tabs-section">
      <div class="container">
        <div class="tabs-header">
          <button class="tab-button active" data-tab="servicios">Nuestros servicios</button>
          <button class="tab-button " data-tab="ubicacion">Ubicaci√≥n</button>
        </div>

        <div class="tabs-body">
          <!-- Tab Servicios -->
          <div id="servicios" class="tab-panel active">
            <div class="section-header">
              <h2>Servicios excepcionales</h2>
              <p>Disfruta de nuestras instalaciones de primera clase dise√±adas para tu comodidad</p>
            </div>
            <div class="services-grid">
              <div class="service-card">
                <div class="service-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
                    <path d="M1.42 9a16 16 0 0 1 21.16 0"></path>
                    <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                    <line x1="12" y1="20" x2="12.01" y2="20"></line>
                  </svg>
                </div>
                <h3>WiFi gratuito</h3>
                <p>Internet de alta velocidad en todas las √°reas</p>
              </div>
              <div class="service-card">
                <div class="service-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 17H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-1"></path>
                    <polygon points="12 15 17 21 7 21 12 15"></polygon>
                  </svg>
                </div>
                <h3>Aparcamiento</h3>
                <p>Parking gratuito para todos nuestros hu√©spedes</p>
              </div>
              <div class="service-card">
                <div class="service-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path>
                    <path d="M7 2v20"></path>
                    <path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path>
                  </svg>
                </div>
                <h3>Restaurante</h3>
                <p>Cocina gourmet con los mejores chefs</p>
              </div>
              <div class="service-card">
                <div class="service-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6.5 6.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path>
                    <path d="M17.5 6.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path>
                    <path d="M12 13.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path>
                    <line x1="6.5" y1="6.5" x2="17.5" y2="6.5"></line>
                    <line x1="6.5" y1="6.5" x2="12" y2="13.5"></line>
                    <line x1="17.5" y1="6.5" x2="12" y2="13.5"></line>
                    <line x1="12" y1="13.5" x2="12" y2="21.5"></line>
                  </svg>
                </div>
                <h3>Gimnasio</h3>
                <p>Centro de fitness equipado 24/7</p>
              </div>
              <div class="service-card">
                <div class="service-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M2 6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6z"></path>
                    <path d="M2 10h20"></path>
                  </svg>
                </div>
                <h3>Piscina</h3>
                <p>Piscina climatizada con vistas panor√°micas</p>
              </div>
            </div>
          </div>

          <!-- Tab Ubicaci√≥n -->
          <div id="ubicacion" class="tab-panel">
            <div class="section-header">
              <h2>Nuestra ubicaci√≥n</h2>
              <p>En el coraz√≥n de Santa Victoria, cerca de todo lo importante</p>
            </div>
            <div class="map-wrap">
              <iframe 
                title="Ubicaci√≥n Hotel Reservas" 
                loading="lazy" 
                referrerpolicy="no-referrer-when-downgrade"
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3917.367607066018!2d-79.8456423250459!3d-6.778935993237899!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x904cef2ef5a82835%3A0x7a336404394faee7!2sHotel%20San%20Eduardo!5e0!3m2!1ses!2spe!4v1736377262004!5m2!1ses!2spe">
              </iframe>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Habitaciones -->
    <section id="habitaciones" class="rooms-section">
      <div class="container">
        <div class="section-header">
          <h2>Nuestras habitaciones</h2>
          <p>Espacios elegantes y confortables para una estancia inolvidable</p>
        </div>

        <div class="rooms-grid">
          <article class="room-card">
            <div class="room-image">
              <img src="{{ url_for('static', filename='img/habitacion_1.jpg') }}" alt="Habitaci√≥n Est√°ndar">
              <div class="room-price">S/ 120 por noche</div>
            </div>
            <div class="room-content">
              <h3>Habitaci√≥n Est√°ndar</h3>
              <div class="room-features">
                <span class="badge">18m¬≤</span>
                <span class="badge">1 hu√©sped</span>
                <span class="badge">Una cama Doble</span>
                <span class="badge">WiFi gratuito</span>
                <span class="badge">Ba√±o privado</span>
                <span class="badge">Tv de Pantalla Plana</span>
              </div>
            </div>
          </article>

          <article class="room-card">
            <div class="room-image">
              <img src="{{ url_for('static', filename='img/habitacion_2.jpg') }}" alt="Suite Junior">
              <div class="room-price">S/ 280 por noche</div>
            </div>
            <div class="room-content">
              <h3>Habitaci√≥n Doble - 2 camas</h3>
              <div class="room-features">
                <span class="badge">18m¬≤</span>
                <span class="badge">4 hu√©spedes</span>
                <span class="badge">Sala de estar</span>
                <span class="badge">WiFi gratuito</span>
                <span class="badge">Ba√±o privado</span>
                <span class="badge">Tv de Pantalla Plana</span>
              </div>
            </div>
            
          </article>

          <article class="room-card">
            <div class="room-image">
              <img src="{{ url_for('static', filename='img/habitacion_3.jpg') }}" alt="Suite Presidencial">
              <div class="room-price">S/ 450 por noche</div>
            </div>
            <div class="room-content">
              <h3>Habitaci√≥n Triple</h3>
              <div class="room-features">
                <span class="badge">18m¬≤</span>
                <span class="badge">5 hu√©spedes</span>
                <span class="badge">Terraza privada</span>
                <span class="badge">WiFi gratuito</span>
                <span class="badge">Ba√±o privado</span>
                <span class="badge">Tv de Pantalla Plana</span>
              </div>
            </div>
          </article>
           <article class="room-card">
            <div class="room-image">
              <img src="{{ url_for('static', filename='img/habitacion_4.jpg') }}" alt="Suite Presidencial">
              <div class="room-price">S/ 550 por noche</div>
            </div>
            <div class="room-content">
              <h3>Habitaci√≥n Doble Est√°ndar</h3>
              <div class="room-features">
                <span class="badge">18m¬≤</span>
                <span class="badge">6 hu√©spedes</span>
                <span class="badge">Vistas a un patio interio</span>
                <span class="badge">WiFi gratuito</span>
                <span class="badge">Ba√±o privado</span>
                <span class="badge">Tv de Pantalla Plana</span>
              </div>
            </div>
          </article>
              <article class="room-card">
            <div class="room-image">
              <img src="{{ url_for('static', filename='img/habitacion_5.jpg') }}" alt="Suite Presidencial">
              <div class="room-price">S/ 450 por noche</div>
            </div>
            <div class="room-content">
              <h3>Suite Presidencial</h3>
              <div class="room-features">
                <span class="badge">50m¬≤</span>
                <span class="badge">6 hu√©spedes</span>
                <span class="badge">Terraza privada</span>
                <span class="badge">WiFi gratuito</span>
                <span class="badge">Ba√±o privado</span>
                <span class="badge">Tv de Pantalla Plana con Cable</span>
                <span class="badge">Aire acondicionado</span>
                <span class="badge">Jacuzzi</span>
                <span class="badge">Piscina</span>
              </div>
            </div>
          </article>
              <article class="room-card">
            <div class="room-image">
              <img src="{{ url_for('static', filename='img/habitacion_6.jpg') }}" alt="Suite Presidencial">
              <div class="room-price">S/ 80 por noche</div>
            </div>
            <div class="room-content">
              <h3>Habitaci√≥n Indivudual</h3>
              <div class="room-features">
                <span class="badge">180m¬≤</span>
                <span class="badge">1 hu√©spedes</span>
                <span class="badge">Una cama Sencilla</span>
                <span class="badge">WiFi gratuito</span>
              </div>
            </div>
          </article>
        </div>

        <div class="text-center">
          <a href="{{ url_for('habitaciones_principales') }}" class="btn btn-primary btn-lg">Ver Todas las Habitaciones</a>
        </div>
      </div>
    </section>

    <!-- Galer√≠a -->
    <section class="gallery-section">
      <div class="container">
        <div class="section-header">
          <h2>Galer√≠a del Hotel</h2>
          <p>Descubre los espacios √∫nicos que hacen especial tu estancia</p>
        </div>

        <div class="gallery-grid">
          <div class="gallery-item">
            <img src="{{ url_for('static', filename='img/habitacion_7.jpg') }}" alt="Galer√≠a 1">
          </div>
          <div class="gallery-item">
            <img src="{{ url_for('static', filename='img/cama.jpg') }}" alt="Galer√≠a 2">
          </div>
          <div class="gallery-item">
            <img src="{{ url_for('static', filename='img/habitacion_9.jpg') }}" alt="Galer√≠a 3">
          </div>
        </div>
      </div>
    </section>

    <!-- Testimonios -->
    <section class="testimonials-section">
      <div class="container">
        <div class="section-header">
          <h2>Lo que dicen nuestros hu√©spedes</h2>
        </div>
        <div class="testimonials-grid">
          <article class="testimonial-card">
            <p>"Ubicaci√≥n perfecta y el personal muy amable adem√°s ‚ÄúLugar c√≥modo y tranquilo
              Tiene Netflix e internet en la TV
              Tiene agua caliente‚Äù"</p>
            <div class="testimonial-user">
              <div class="user-avatar">ML</div>
              <div>
                <strong>Fernando</strong>
                <small>Estad√≠a en Suite</small>
              </div>
            </div>
          </article>
          <article class="testimonial-card">
            <p>‚ÄúEl personal muy capacitado y muy amable, de verdad volver√≠a a este hotel, su limpieza muy buena, y sobre todo la comodidadüòÅ‚Äù"</p>
            <div class="testimonial-user">
              <div class="user-avatar">CR</div>
              <div>
                <strong>Aylin</strong>
                <small>Viaje de negocios</small>
              </div>
            </div>
          </article>
          <article class="testimonial-card">
            <p>‚ÄúFue una buena experiencia, el hotel se ubica en una zona c√©ntrica donde mantiene buena comodidad con el Huesped "</p>
            <div class="testimonial-user">
              <div class="user-avatar">GP</div>
              <div>
                <strong>Anghi</strong>
                <small>Vacaciones</small>
              </div>
            </div>
          </article>
        </div>
      </div>
    </section>

    <!-- CTA -->
    <section id="reservas" class="cta-section">
      <div class="container">
        <h2>¬øListo para tu Experiencia Perfecta?</h2>
        <p>Reserva ahora y disfruta de tarifas especiales. Tu habitaci√≥n ideal te est√° esperando.</p>
        <div class="cta-actions">
           <a href="{{ url_for('usuarios.iniciosesion') }}" class="btn btn-white btn-lg">
              <!-- svg -->
              Hacer Reserva
            </a>
          <a href="{{ url_for('usuarios.contacto') }}" class="btn btn-outline-white btn-lg">Contactar</a>
        </div>
      </div>
    </section>

    <!-- Asistente Virtual (Chatbot) -->
    <div class="chat-widget-container">
      <!-- Ventana de Chat (inicialmente oculta) -->
      <div class="chat-box" id="chatBox">
        <div class="chat-header">
          <h3>Asistente Virtual</h3>
          <p>A tu servicio</p>
          <button class="chat-close-btn" id="chatCloseBtn" aria-label="Cerrar chat">&times;</button>
        </div>
        <div class="chat-body">
          <div class="chat-messages" id="chatMessages" aria-live="polite"></div>
          <div class="chat-input-container">
            <form class="chat-input" id="chatForm" autocomplete="off">
              <input id="chatInput" type="text" placeholder="Escribe tu mensaje..." aria-label="Mensaje" required>
              <button class="btn-send" type="submit" aria-label="Enviar mensaje">&rarr;</button>
            </form>
          </div>
        </div>
      </div>

      <!-- Burbuja para abrir el chat -->
      <button class="chat-bubble" id="chatBubble" aria-label="Abrir chat de soporte">
        <svg class="icon-chat" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
        <svg class="icon-close" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      </button>
    </div>
{% endblock %}

{% block extra_css %}
  {{ super() }}
  <style>
    /* =========================================
       ESTILOS PARA EL WIDGET DE CHAT (ASISTENTE VIRTUAL)
       ========================================= */
    .chat-widget-container {
      position: fixed;
      bottom: 25px;
      right: 25px;
      z-index: 1000;
    }

    .chat-bubble {
      width: 60px;
      height: 60px;
      background: var(--primary); /* Usa el color primario de tu web */
      border-radius: 50%;
      border: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s ease, background 0.3s ease;
    }
    .chat-bubble:hover {
      transform: scale(1.1);
    }
    .chat-bubble svg {
      width: 28px;
      height: 28px;
      fill: white;
      stroke: white;
      position: absolute;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    .chat-bubble .icon-close {
      transform: scale(0) rotate(-90deg);
      opacity: 0;
    }
    .chat-bubble.open .icon-chat {
      transform: scale(0) rotate(90deg);
      opacity: 0;
    }
    .chat-bubble.open .icon-close {
      transform: scale(1) rotate(0deg);
      opacity: 1;
    }

    .chat-box {
      position: absolute;
      bottom: 80px;
      right: 0;
      width: min(90vw, 350px);
      height: min(75vh, 560px);
      max-height: calc(100vh - 120px);
      background: white;
      border-radius: 15px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transform: scale(0.5) translateY(100px);
      opacity: 0;
      transform-origin: bottom right;
      transition: transform 0.3s ease, opacity 0.3s ease;
      pointer-events: none;
    }
    .chat-box.open {
      transform: scale(1) translateY(0);
      opacity: 1;
      pointer-events: auto;
    }
    .chat-header {
      background: var(--dark);
      color: white;
      padding: 15px 20px;
      position: relative;
    }
    .chat-header h3 { margin: 0; font-size: 16px; }
    .chat-header p { margin: 2px 0 0; font-size: 12px; opacity: 0.8; }
    .chat-close-btn {
      position: absolute;
      top: 50%;
      right: 15px;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      opacity: 0.7;
    }
    .chat-close-btn:hover { opacity: 1; }
    .chat-body {
      flex: 1;
      background: #f0f2f5;
      display: flex;
      flex-direction: column;
      overflow: hidden; /* Clave: Evita que el body se desborde */
    }
    .chat-messages {
      flex: 1;
      /* Ajustamos el padding para compensar el scrollbar */
      padding-left: 15px;
      padding-top: 15px;
      padding-bottom: 15px;
      padding-right: 10px; /* Menos padding a la derecha */
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-gutter: stable both-edges;
    }
    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }
    .chat-messages::-webkit-scrollbar-thumb {
      background-color: #ccc;
      border-radius: 3px;
    }
    .chat-messages::-webkit-scrollbar-thumb:hover {
      background-color: #aaa;
    }
    .msg {
      padding: 8px 12px;
      border-radius: 18px;
      max-width: 80%;
      word-wrap: break-word;
    }
    .msg-bot {
      background: #e5e5ea;
      color: #000;
      border-bottom-left-radius: 4px;
      align-self: flex-start;
      white-space: pre-line; /* Clave para respetar los saltos de l√≠nea */
    }
    .msg-user {
      background: var(--primary);
      color: white;
      border-bottom-right-radius: 4px;
      align-self: flex-end;
    }
    .chat-input-container { padding: 10px; background: #fff; border-top: 1px solid #e5e7eb; }
    .chat-input { display: flex; gap: 8px; }
    .chat-input input { flex: 1; border: 1px solid #ccc; border-radius: 20px; padding: 8px 15px; }
    .chat-input .btn-send { background: var(--primary); color: white; border: none; border-radius: 50%; width: 36px; height: 36px; cursor: pointer; font-size: 20px; }



    /* =========================================
       RESPONSIVE DESIGN PARA index.html
       ========================================= */

    /* Ajustes para pantallas medianas (tablets, ~768px a 1024px) */
    @media (max-width: 1024px) {
      .container { padding: 0 20px; }
      .hero-content h1 { font-size: 3.5rem; }
      .hero-content p { font-size: 1.1rem; }
      .services-grid, .rooms-grid, .gallery-grid, .testimonials-grid {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      }
      .room-card .room-image { height: 220px; }
    }

    /* Ajustes para pantallas peque√±as (m√≥viles, ~480px a 767px) */
    @media (max-width: 767px) {
      .hero-content h1 { font-size: 2.5rem; }
      .hero-content p { font-size: 1rem; }
      .hero-actions { flex-direction: column; gap: 15px; }
      .hero-actions .btn { width: 100%; }
      .tabs-header { flex-direction: column; gap: 10px; }
      .tabs-header .tab-button { width: 100%; }
      .services-grid, .rooms-grid, .gallery-grid, .testimonials-grid {
        grid-template-columns: 1fr; /* Una columna para m√≥viles */
      }
      .room-card { flex-direction: column; }
      .room-card .room-image { width: 100%; height: 250px; }
      .cta-actions { flex-direction: column; gap: 15px; }
      .cta-actions .btn { width: 100%; }
      .section-header h2 { font-size: 2rem; }
      .section-header p { font-size: 0.9rem; }
    }

    /* Ajustes para pantallas muy peque√±as (menos de 480px) */
    @media (max-width: 480px) {
      .container { padding: 0 15px; }
      .hero-content h1 { font-size: 2rem; }
      .hero-content p { font-size: 0.9rem; }
      .section-header h2 { font-size: 1.8rem; }
      .section-header p { font-size: 0.85rem; }
      .whatsapp-fab-container { bottom: 15px; right: 15px; }
      .whatsapp-fab { width: 50px; height: 50px; }
      .whatsapp-fab svg { width: 28px; height: 28px; }
      .whatsapp-fab-options { margin-bottom: 10px; }
      .whatsapp-option { padding: 8px 12px; }
      .whatsapp-option-text strong { font-size: 13px; }
      .whatsapp-option-text span { font-size: 11px; }
      .whatsapp-icon-small { width: 24px; height: 24px; }
    }
  </style>
{% endblock %}

{% block extra_js %}
  {{ super() }}
  <script>
  (function(){
    const $msgs = document.getElementById('chatMessages');
    const $form = document.getElementById('chatForm');
    const $input = document.getElementById('chatInput');
    const $bubble = document.getElementById('chatBubble');
    const $box = document.getElementById('chatBox');
    const $closeBtn = document.getElementById('chatCloseBtn');

    /* --- helpers de scroll --- */
    const nearBottom = el => (el.scrollHeight - el.clientHeight - el.scrollTop) < 12;
    const scrollBottom = el => { el.scrollTop = el.scrollHeight; };

    function toggleChat() {
      $bubble.classList.toggle('open');
      $box.classList.toggle('open');
      if ($box.classList.contains('open') && !$box.dataset.welcomed) {
        welcome();
      }
    }

    function addMsg(text, who){
      const stick = nearBottom($msgs); // ¬øestaba abajo antes de a√±adir?
      const div = document.createElement('div');
      div.className = 'msg ' + (who === 'user' ? 'msg-user' : 'msg-bot');      
      div.innerHTML = text; // Usamos innerHTML para renderizar los enlaces <a>
      $msgs.appendChild(div);

      // si estaba abajo, mantenlo abajo despu√©s de pintar
      if (stick) requestAnimationFrame(() => scrollBottom($msgs));
      $msgs.scrollTop = $msgs.scrollHeight;
    }

    async function sendToBot(text){
      try{
        const r = await fetch("{{ url_for('webchat.webchat_message') }}", { // Aseg√∫rate que el endpoint es correcto
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({text})
        });
        const j = await r.json();
        addMsg(j.reply || '‚Ä¶', 'bot');
      }catch(e){
        addMsg('‚ö†Ô∏è Error de conexi√≥n', 'bot');
        console.error(e);
      }
    }

    async function welcome() {
        try {
            const r = await fetch("{{ url_for('webchat.webchat_welcome') }}"); // Ruta de bienvenida
            const j = await r.json();
            addMsg(j.reply, 'bot');
            $box.dataset.welcomed = 'true';
        } catch(e) {
            addMsg('üëã Hola, soy tu asistente. ¬øEn qu√© puedo ayudarte?', 'bot');
            console.error(e);
        }
    }

    if($form){
      $form.addEventListener('submit', (ev)=>{
        ev.preventDefault();
        const text = ($input.value || '').trim();
        if(!text) return;
        addMsg(text, 'user');
        $input.value = '';
        sendToBot(text);
      });
    }

    // Abrir/Cerrar chat
    if($bubble) $bubble.addEventListener('click', toggleChat);
    if($closeBtn) $closeBtn.addEventListener('click', toggleChat);

    // Bot√≥n "Reservar Ahora" dispara el chat con "reservar"
    const reservarBtn = document.getElementById('btnReservarAhora');
    if (reservarBtn){
      reservarBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        if (!$bubble.classList.contains('open')) {
          $bubble.click();
        }
        setTimeout(() => {
          addMsg('reservar','user');
          sendToBot('reservar');
        }, 300);
      });
    }

    // Si cambia el tama√±o de la ventana, reubica el scroll
    window.addEventListener('resize', () => setTimeout(() => scrollBottom($msgs), 120));
    window.addEventListener('resize', () => { $msgs.scrollTop = $msgs.scrollHeight; });
  })();
  </script>
{% endblock %}
