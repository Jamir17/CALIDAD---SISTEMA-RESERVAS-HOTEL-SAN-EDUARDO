{% extends "base.html" %}

{% block title %}Mi Perfil - Hotel San Eduardo{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/perfil.css') }}">
{% endblock %}

{% block content %}
<!-- Profile Section -->
<section class="profile-section">
    <div class="container">
        <h1 class="page-title">Mi Perfil</h1>

        <!-- Mensajes Flash -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %} 
                {% for category, message in messages %} 
                    {% if category == 'success' %}
                        <div id="successMessage" data-message="{{ message }}"></div>
                    {% else %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endif %}
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div class="profile-grid">
            <!-- Profile Card -->
            <div class="profile-card">
                <div class="profile-header">
                    <div class="profile-avatar">{{ usuario.nombres[0] if usuario.nombres else 'U' }}</div>
                    <div>
                        <h2>{{ usuario.nombres }} {{ usuario.apellidos }}</h2>
                        <p class="profile-email">{{ usuario.correo }}</p>
                    </div>
                </div>
                
                <div class="profile-stats">
                    <div class="stat">
                        <div class="stat-value">12</div>
                        <div class="stat-label">Reservas</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">3</div>
                        <div class="stat-label">Activas</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">2</div>
                        <div class="stat-label">A√±os</div>
                    </div>
                </div>
            </div>

            <!-- Edit Form -->
            <div class="profile-form-card">
                <h3>Informaci√≥n Personal</h3>
                <form class="profile-form" method="POST" action="{{ url_for('perfil.ver_perfil') }}">
                    <div class="form-group">
                        <label>Nombres</label>
                        <input type="text" name="nombres" value="{{ usuario.nombres }}" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Apellidos</label>
                        <input type="text" name="apellidos" value="{{ usuario.apellidos }}" class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" value="{{ usuario.correo }}" class="form-input" readonly title="El correo no se puede modificar.">
                    </div>
                    
                    <div class="form-group">
                        <label>Tel√©fono</label>
                        <input type="tel" name="telefono" value="{{ usuario.telefono }}" class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label>Documento de Identidad</label>
                        <input type="text" value="{{ usuario.num_documento }}" class="form-input" readonly title="El documento no se puede modificar.">
                    </div>
                    
                    <div class="form-group">
                        <label>Direcci√≥n</label>
                        <input type="text" name="direccion" value="{{ usuario.direccion or '' }}" class="form-input">
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </form>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="activity-card">
            <h3>Actividad Reciente</h3>
            <div class="activity-list">
                <div class="activity-item">
                    <div class="activity-icon">‚úì</div>
                    <div class="activity-content">
                        <div class="activity-title">Reserva confirmada</div>
                        <div class="activity-date">Hace 2 d√≠as</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">üìù</div>
                    <div class="activity-content">
                        <div class="activity-title">Perfil actualizado</div>
                        <div class="activity-date">Hace 1 semana</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">‚≠ê</div>
                    <div class="activity-content">
                        <div class="activity-title">Rese√±a publicada</div>
                        <div class="activity-date">Hace 2 semanas</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ===============================
     üåø MODAL DE CONFIRMACI√ìN √âXITO
     =============================== -->
<div class="modal-overlay" id="modalSuccess" aria-hidden="true" role="dialog">
  <div class="modal-success" role="document">
    <div class="checkmark">
      <svg viewBox="0 0 52 52">
        <path d="M14 27 l7 7 l17 -17" />
      </svg>
    </div>
    <h2 id="modalSuccessTitle">¬°Perfil actualizado!</h2>
    <p id="modalSuccessMessage">Tus datos han sido guardados correctamente.</p>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  const successDiv = document.getElementById("successMessage");
  if (successDiv) {
    const modal = document.getElementById("modalSuccess");
    const title = document.getElementById("modalSuccessTitle");
    
    // Opcional: Personalizar el t√≠tulo con el mensaje flash
    if (title && successDiv.dataset.message) {
        title.textContent = successDiv.dataset.message;
    }

    modal.classList.add("open");
    modal.setAttribute("aria-hidden", "false");

    setTimeout(() => {
      modal.classList.remove("open");
      modal.setAttribute("aria-hidden", "true");
    }, 1000); // Desaparece despu√©s de 1 segundo
  }
});
</script>
{% endblock %}
