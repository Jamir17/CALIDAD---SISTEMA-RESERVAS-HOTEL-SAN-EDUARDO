<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel - Hotel San Eduardo</title>

    <!-- CSS base -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/principal.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/panel_checkinout.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/reservas_cliente.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/panel_reservas.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/reserva_cliente.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/respaldo.css') }}">
    {% block extra_css %}{% endblock %}

    <style>
        /* Corrección para que el submenú activo se resalte correctamente */
        .sidebar ul a.active {
            background-color: #0056b3; /* Un azul más oscuro para el sub-item activo */
            color: #fff;
        }
    </style>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">


</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <h2>Hotel San Eduardo</h2>

        {% if session['rol'] == 1 %}
            <a href="{{ url_for('admin.dashboard') }}" class="{{ 'active' if request.endpoint == 'admin.dashboard' else '' }}">Menu principal</a>
            <a href="{{ url_for('reservas_admin.panel_reservas') }}" class="{{ 'active' if 'reservas_admin' in request.endpoint else '' }}">Reservas</a>
            <a href="{{ url_for('checkinout.panel_checkinout') }}" class="{{ 'active' if 'checkinout' in request.endpoint else '' }}">Check-in/out</a>
            <a href="{{ url_for('gestion_habitaciones.panel_habitaciones') }}" class="{{ 'active' if 'gestion_habitaciones' in request.endpoint else '' }}">Gestión de Habitaciones</a>
            <a href="{{ url_for('incidencias.panel_incidencias') }}" class="{{ 'active' if 'incidencias.panel_incidencias' in request.endpoint else '' }}">Gestión de Incidencias</a>

            <a href="{{ url_for('reservas_cliente.historial_reservas_cliente') }}" class="{{ 'active' if 'reservas_cliente' in request.endpoint else '' }}">Historial de reservas por cliente</a>

            {% set seguridad_active = 'gestion_usuarios_roles' in request.endpoint or 'gestion_roles' in request.endpoint or 'respaldo' in request.endpoint %}
            <a href="#" onclick="toggleSeguridadMenu()" class="{{ 'active' if seguridad_active else '' }}">
                Seguridad ▼
            </a>
            <ul id="submenuSeguridad" style="list-style:none; padding-left:15px; display: {% if seguridad_active %}block{% else %}none{% endif %};">
                <li><a href="{{ url_for('gestion_usuarios_roles.listar_usuarios_y_roles') }}" class="{{ 'active' if request.endpoint == 'gestion_usuarios_roles.listar_usuarios_y_roles' else '' }}">Asignar roles a usuarios</a></li>
                <li><a href="{{ url_for('gestion_roles.listar_roles') }}" class="{{ 'active' if request.endpoint == 'gestion_roles.listar_roles' else '' }}">Administrar roles</a></li>
                <li><a href="{{ url_for('respaldo.panel_respaldo') }}" class="{{ 'active' if 'respaldo' in request.endpoint else '' }}">Respaldos</a></li>
            </ul>

            {% set mantenimiento_active = 'mantenimiento_overview' in request.endpoint or 'mantenimiento_tasks' in request.endpoint %}
            <a href="#" onclick="toggleMantenimientoMenu()" class="{{ 'active' if mantenimiento_active else '' }}">
                Mantenimiento ▼
            </a>
            <ul id="submenuMantenimiento" style="list-style:none; padding-left:15px; display: {% if mantenimiento_active %}block{% else %}none{% endif %};">
                <li><a href="{{ url_for('mantenimiento.panel_mantenimiento') }}">Visión General</a></li>
            </ul>

        {% elif session['rol'] == 2 %}
            <a href="{{ url_for('reservas_admin.panel_reservas') }}" class="{{ 'active' if 'reservas_admin' in request.endpoint else '' }}">Reservas</a>
            <a href="{{ url_for('checkinout.panel_checkinout') }}" class="{{ 'active' if 'checkinout' in request.endpoint else '' }}">Check-in/out</a>
            <a href="{{ url_for('reservas_cliente.historial_reservas_cliente') }}" class="{{ 'active' if 'reservas_cliente' in request.endpoint else '' }}">Historial de reservas por cliente</a>

        {% elif session['rol'] == 4 %} {# Rol Mantenimiento #}
            <a href="{{ url_for('incidencias.panel_incidencias') }}" class="{{ 'active' if 'incidencias' in request.endpoint else '' }}">Gestión de Incidencias</a>
        {% endif %}
    </div>

    <!-- Contenido principal -->
    <div class="content">
        <div class="topbar">
            <div class="user-info">
                Bienvenido, {{ session.get('nombre', 'Usuario') }}
            </div>
            <a href="{{ url_for('usuarios.logout') }}" class="logout-btn">Cerrar sesión</a>
        </div>

        <div class="mt-4">
            {% block content %}
            {% endblock %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    {% if 'checkinout' in request.path %}
    <script src="{{ url_for('static', filename='js/panel_checkinout.js') }}"></script>
    
    {% endif %}

    <script>
    function toggleSeguridadMenu() {
        const menu = document.getElementById('submenuSeguridad');
        menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    }

    function toggleMantenimientoMenu() {
        const menu = document.getElementById('submenuMantenimiento');
        menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    }
    </script>
    {% block extra_js %}{% endblock %}

</body>
</html>
